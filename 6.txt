SELECT S1.CUSTOMER_ID, S1.LAST_ORDER_DATE, S2.PENULTIMATE_ORDER_DATE,  (S1.LAST_ORDER_DATE + (S1.LAST_ORDER_DATE - S2.PENULTIMATE_ORDER_DATE)) AS next_projected_order_date, 
(S1.LAST_ORDER_REVENUE + S2.PENULTIMATE_ORDER_REVENUE)/2 AS next_projected_order_value
FROM 
(SELECT X.CUSTOMER_ID, X.LAST_ORDER_DATE, (O.TOTAL_PRICE - O.TOTAL_TAX) LAST_ORDER_REVENUE FROM ORDERS O
INNER JOIN 
(SELECT A.CUSTOMER_ID, MAX(A.CREATED_AT) AS last_order_date FROM ORDERS A WHERE A.CUSTOMER_ID IN (SELECT X.CUSTOMER_ID FROM (SELECT CUSTOMER_ID, COUNT(*) FROM ORDERS GROUP BY CUSTOMER_ID HAVING COUNT(*) > 1
 ) X)
 GROUP BY A.CUSTOMER_ID) X ON O.CUSTOMER_ID = X.CUSTOMER_ID AND O.CREATED_AT = X.LAST_ORDER_DATE) S1
INNER JOIN
(SELECT Y.CUSTOMER_ID, Y.penultimate_order_date, (P.TOTAL_PRICE - P.TOTAL_TAX) PENULTIMATE_ORDER_REVENUE FROM ORDERS P
INNER JOIN
 (SELECT A.CUSTOMER_ID, MAX(A.CREATED_AT) penultimate_order_date FROM ORDERS A WHERE A.CREATED_AT < (SELECT MAX(B.CREATED_AT) FROM ORDERS B WHERE B.CUSTOMER_ID = A.CUSTOMER_ID)
 GROUP BY A.CUSTOMER_ID) Y
 ON P.CUSTOMER_ID = Y.CUSTOMER_ID AND P.CREATED_AT = Y.penultimate_order_date) S2 
 ON S1.CUSTOMER_ID = S2.CUSTOMER_ID
 WHERE (DATE_PART('day', S1.LAST_ORDER_DATE::timestamp - S2.PENULTIMATE_ORDER_DATE::timestamp) * 24 + 
               DATE_PART('hour', S1.LAST_ORDER_DATE::timestamp - S2.PENULTIMATE_ORDER_DATE::timestamp)) * 60 +
               DATE_PART('minute', S1.LAST_ORDER_DATE::timestamp - S2.PENULTIMATE_ORDER_DATE::timestamp) >= 60;